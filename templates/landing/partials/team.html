<!-- Team Section with Swiper Carousel -->
<section id="equipo" class="py-20 bg-pg-black/60 overflow-visible" data-scroll-reveal>
    <div class="container mx-auto px-4 overflow-visible">
        <div data-animate class="opacity-0 text-center mb-12">
            <h2 class="text-5xl font-black mb-4">
                <span class="text-white">Nuestro</span> <span class="text-pg-orange">Equipo</span>
            </h2>
            <div class="w-24 h-1 bg-gradient-orange mx-auto rounded-full mb-4"></div>
            <p class="text-gray-400 text-lg">Profesionales dedicados a tu transformación</p>
        </div>

        {% if team_members %}
        <!-- Swiper Carousel -->
        <div class="max-w-7xl mx-auto relative">
            <div class="swiper teamSwiper">
                <div class="swiper-wrapper pb-12">
                    {% for member in team_members %}
                    <div class="swiper-slide">
                        <div class="group">
                            <div class="relative bg-white/5 rounded-2xl overflow-hidden border border-white/10 hover:border-pg-orange/50 transition-all duration-300 hover-glow h-full">
                                <!-- Photo -->
                                <div class="aspect-square overflow-hidden">
                                    {% if member.foto %}
                                    <img src="{{ member.foto.url }}" alt="{{ member.nombre }}"
                                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 swiper-lazy">
                                    <div class="swiper-lazy-preloader"></div>
                                    {% else %}
                                    <div class="w-full h-full bg-gradient-to-br from-pg-orange/20 to-amber-500/10 flex items-center justify-center">
                                        <svg class="w-24 h-24 text-pg-orange/40" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                        </svg>
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Info -->
                                <div class="p-4">
                                    <h3 class="text-lg font-bold text-white group-hover:text-pg-orange transition-colors">
                                        {{ member.nombre }}</h3>
                                    <p class="text-pg-orange text-sm font-semibold">{{ member.get_puesto_display }}{% if member.puesto_secundario %} / {{ member.get_puesto_secundario_display }}{% endif %}</p>

                                    {% if member.cv_info %}
                                    <div class="mt-3 pt-3 border-t border-white/10">
                                        <p class="text-gray-400 text-sm line-clamp-3">{{ member.cv_info|truncatechars:150 }}</p>
                                    </div>
                                    {% endif %}

                                    <!-- Video Button -->
                                    {% if member.video_url %}
                                    <div class="mt-3 pt-3 border-t border-white/10">
                                        <button onclick="openVideoModal('{{ member.get_youtube_embed_url }}', '{{ member.nombre }}')"
                                            class="w-full py-2.5 px-4 bg-gradient-to-r from-pg-orange to-amber-500 hover:from-pg-orange/90 hover:to-amber-500/90 text-white font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 group/btn">
                                            <svg class="w-5 h-5 transition-transform group-hover/btn:scale-110" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z" />
                                            </svg>
                                            Ver Entrevista
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                <div class="swiper-pagination !bottom-0"></div>
            </div>

            <!-- Navigation buttons OUTSIDE swiper - Premium Glassmorphic Design -->
            <button class="swiper-button-prev absolute left-0 top-1/2 -translate-y-1/2 z-50 w-16 h-16 rounded-full bg-black/40 backdrop-blur-md border border-white/10 text-white flex items-center justify-center hover:bg-pg-orange hover:border-pg-orange hover:shadow-[0_0_20px_rgba(249,115,22,0.5)] hover:scale-110 transition-all duration-300 group">
                <svg class="w-8 h-8 opacity-70 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            <button class="swiper-button-next absolute right-0 top-1/2 -translate-y-1/2 z-50 w-16 h-16 rounded-full bg-black/40 backdrop-blur-md border border-white/10 text-white flex items-center justify-center hover:bg-pg-orange hover:border-pg-orange hover:shadow-[0_0_20px_rgba(249,115,22,0.5)] hover:scale-110 transition-all duration-300 group">
                <svg class="w-8 h-8 opacity-70 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
        {% else %}
        <div class="col-span-full text-center py-12">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-pg-orange/10 mb-4">
                <svg class="w-10 h-10 text-pg-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </div>
            <p class="text-gray-500 text-lg">Próximamente conocerás a nuestro equipo</p>
        </div>
        {% endif %}
    </div>
</section>

<style>
    /* Swiper Custom Styles for Team Section */
    .teamSwiper {
        padding: 60px 120px !important;
        overflow: visible !important;
    }

    .teamSwiper .swiper-wrapper {
        align-items: stretch;
    }

    .teamSwiper .swiper-slide {
        opacity: 0.5;
        transform: scale(0.9);
        transition: all 0.4s ease;
        height: auto !important;
    }

    .teamSwiper .swiper-slide > div > div {
        min-height: 550px;
        display: flex;
        flex-direction: column;
    }

    .teamSwiper .swiper-slide-active {
        opacity: 1 !important;
        transform: scale(1.05) !important;
        z-index: 10;
    }

    /* Remove previous CSS overrides for buttons as we are styling inline with Tailwind */
    #equipo .swiper-button-next,
    #equipo .swiper-button-prev {
        display: flex !important; 
    }
    
    /* Remove the old CSS that assumed they were inside .teamSwiper or had no styling */


    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .teamSwiper {
            padding: 40px 80px !important;
        }
        
        .teamSwiper .swiper-slide > div > div {
            min-height: 500px;
        }
    }

    .teamSwiper .swiper-pagination-bullet {
        background: #fff;
        opacity: 0.5;
    }

    .teamSwiper .swiper-pagination-bullet-active {
        background: #F97316;
        opacity: 1;
    }
</style>

<!-- Video Modal -->
<div id="videoModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
    <div class="relative w-full max-w-5xl">
        <!-- Close Button -->
        <button onclick="closeVideoModal()"
            class="absolute -top-12 right-0 md:-right-12 md:top-0 w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-pg-orange text-white transition-all duration-300 group">
            <svg class="w-6 h-6 transition-transform group-hover:rotate-90" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <!-- Video Container -->
        <div class="relative bg-black rounded-2xl overflow-hidden shadow-2xl border border-white/10">
            <!-- Title -->
            <div class="p-4 bg-gradient-to-r from-pg-orange to-amber-500">
                <h3 id="videoModalTitle" class="text-white font-bold text-lg md:text-xl"></h3>
            </div>

            <!-- Video iframe - 16:9 aspect ratio -->
            <div class="relative w-full" style="padding-bottom: 56.25%;">
                <iframe id="videoIframe" class="absolute inset-0 w-full h-full" src="" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>
</div>

<script>
    function openVideoModal(videoUrl, title) {
        if (!videoUrl) return;
        
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        const modalTitle = document.getElementById('videoModalTitle');
        
        // Add autoplay to URL if not present
        let finalUrl = videoUrl;
        if (finalUrl.indexOf('?') > -1) {
            finalUrl += '&autoplay=1';
        } else {
            finalUrl += '?autoplay=1';
        }
        
        iframe.src = finalUrl;
        modalTitle.textContent = title || 'Entrevista';
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeVideoModal() {
        const modal = document.getElementById('videoModal');
        const iframe = document.getElementById('videoIframe');
        
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        iframe.src = '';
        document.body.style.overflow = '';
    }

    document.addEventListener('DOMContentLoaded', function () {
        if (typeof Swiper !== 'undefined') {
            new Swiper('.teamSwiper', {
                slidesPerView: 3,
                spaceBetween: 30,
                centeredSlides: true,
                loop: true,
                
                autoplay: {
                    delay: 4000,
                    disableOnInteraction: false,
                    pauseOnMouseEnter: true,
                },

                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },

                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                    dynamicBullets: true,
                },

                breakpoints: {
                    320: {
                        slidesPerView: 1,
                        spaceBetween: 20,
                    },
                    768: {
                        slidesPerView: 2,
                        spaceBetween: 20,
                    },
                    1024: {
                        slidesPerView: 3,
                        spaceBetween: 30,
                    },
                },

                speed: 600,
            });
        }
    });

    // Close modal on outside click
    document.getElementById('videoModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeVideoModal();
        }
    });
</script>
